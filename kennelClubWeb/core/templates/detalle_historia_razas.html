{% extends "base.html" %}
{% load static %}

{% block title %}{{ historia.titulo }}{% endblock %}

{% block content %}
<div class="w-full">
    <!-- Título -->
    <div class="mb-10 text-center">
        <h1 class="text-2xl md:text-3xl lg:text-4xl font-bold title-color px-4">{{ historia.titulo }}</h1>
    </div>

    {% if fotos %}
        <!-- Carrusel de fotos -->
        <div class="w-full max-w-3xl mx-auto relative">
            <div class="h-96 overflow-hidden rounded-lg md:h-[500px]">
                {% for foto in fotos %}
                    <div class="carousel-slide {% if forloop.first %}block{% else %}hidden{% endif %} w-full h-full">
                        <img src="{{ foto.imagen.url }}" class="w-full h-full object-contain" alt="{{ historia.titulo }} - Foto {{ forloop.counter }}">
                    </div>
                {% endfor %}

                <!-- Indicadores -->
                {% if fotos|length > 1 %}
                    <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2 z-10">
                        {% for foto in fotos %}
                            <button type="button" class="carousel-indicator w-3 h-3 rounded-full {% if forloop.first %}bg-blue-600{% else %}bg-gray-300{% endif %} transition-colors duration-200" data-index="{{ forloop.counter0 }}">
                            </button>
                        {% endfor %}
                    </div>
                {% endif %}
            </div>

            {% if fotos|length > 1 %}
                <!-- Controles de navegación -->
                <button type="button" class="carousel-prev absolute top-1/2 left-2 transform -translate-y-1/2 z-10 flex items-center justify-center w-12 h-12 rounded-full bg-sky-200 hover:bg-sky-300 transition-colors duration-200 shadow-lg">
                    <svg class="w-6 h-6 text-sky-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                    </svg>
                </button>
                <button type="button" class="carousel-next absolute top-1/2 right-2 transform -translate-y-1/2 z-10 flex items-center justify-center w-12 h-12 rounded-full bg-sky-200 hover:bg-sky-300 transition-colors duration-200 shadow-lg">
                    <svg class="w-6 h-6 text-sky-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                    </svg>
                </button>
            {% endif %}
        </div>
    {% else %}
        <!-- Mensaje cuando no hay fotos -->
        <div class="text-center py-20">
            <div class="bg-gray-100 rounded-lg p-8 max-w-md mx-auto">
                <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <p class="paragraph-color">No hay fotos disponibles para esta historia.</p>
            </div>
        </div>
    {% endif %}
</div>

<!-- Sección de Clubes Asociados -->
{% if clubes %}
    <div class="w-full max-w-4xl mx-auto mt-12 px-4">
        <h2 class="text-2xl md:text-3xl font-bold title-color text-center mb-8">Clubes Asociados</h2>
        <div class="space-y-6">
            {% for club in clubes %}
                <div class="bg-white rounded-lg shadow-lg overflow-hidden border border-gray-200 hover:shadow-xl transition-shadow duration-300">
                    <div class="flex flex-col md:flex-row">
                        <!-- Logo del club -->
                        <div class="md:w-1/3 bg-gray-50 flex items-center justify-center p-6">
                            {% if club.logo %}
                                <img src="{{ club.logo.url }}" alt="Logo de {{ club.titulo }}" class="max-w-full max-h-48 object-contain">
                            {% else %}
                                <div class="w-32 h-32 bg-gray-200 rounded-lg flex items-center justify-center">
                                    <svg class="w-16 h-16 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                    </svg>
                                </div>
                            {% endif %}
                        </div>

                        <!-- Información del club -->
                        <div class="md:w-2/3 p-6 flex flex-col justify-between">
                            <div>
                                <h3 class="text-xl font-bold title-color mb-3">{{ club.titulo }}</h3>
                                {% if club.descripcion %}
                                    <div class="text-gray-700 prose prose-sm max-w-none">
                                        {{ club.descripcion|safe }}
                                    </div>
                                {% else %}
                                    <p class="text-gray-500 italic">Sin descripción disponible</p>
                                {% endif %}
                            </div>
                            {% if club.link %}
                                <div class="mt-4">
                                    <a href="{{ club.link }}" target="_blank" rel="noopener noreferrer" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition-colors duration-200">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                        </svg>
                                        Visitar Sitio Web
                                    </a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endif %}

<!-- Botón de volver -->
<div class="mt-8 text-center">
    <a href="{% url 'historia_razas' %}" class="inline-block px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition duration-300">
        Volver a Razas
    </a>
</div>

<!-- Script para el carrusel -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('.w-full.max-w-3xl.mx-auto');
    if (!carousel) return;

    const slides = carousel.querySelectorAll('.carousel-slide');
    const prevBtn = carousel.querySelector('.carousel-prev');
    const nextBtn = carousel.querySelector('.carousel-next');
    const indicators = carousel.querySelectorAll('.carousel-indicator');
    let currentIndex = 0;

    function showSlide(index) {
        // Ocultar todas las imágenes
        slides.forEach(slide => slide.classList.add('hidden'));
        slides.forEach(slide => slide.classList.remove('block'));

        // Mostrar la imagen actual
        if (slides[index]) {
            slides[index].classList.remove('hidden');
            slides[index].classList.add('block');
        }

        // Actualizar indicadores
        indicators.forEach((indicator, i) => {
            if (i === index) {
                indicator.classList.remove('bg-gray-300');
                indicator.classList.add('bg-blue-600');
            } else {
                indicator.classList.remove('bg-blue-600');
                indicator.classList.add('bg-gray-300');
            }
        });
    }

    function nextSlide() {
        currentIndex = (currentIndex + 1) % slides.length;
        showSlide(currentIndex);
    }

    function prevSlide() {
        currentIndex = (currentIndex - 1 + slides.length) % slides.length;
        showSlide(currentIndex);
    }

    // Event listeners
    if (prevBtn) prevBtn.addEventListener('click', prevSlide);
    if (nextBtn) nextBtn.addEventListener('click', nextSlide);

    indicators.forEach((indicator, index) => {
        indicator.addEventListener('click', () => {
            currentIndex = index;
            showSlide(currentIndex);
        });
    });

    // Mostrar la primera imagen al cargar
    showSlide(0);
});
</script>
{% endblock %} 